---
title: "Lineare Modelle"
author: "Statistik mit R<br>
  <a href='https://therbootcamp.github.io'>
    The R Bootcamp
  </a>
  <br>
  <a href='https://therbootcamp.github.io/SmR_2020Mar/'>
    <i class='fas fa-clock' style='font-size:.9em;'></i>
  </a>&#8239; 
  <a href='https://therbootcamp.github.io'>
    <i class='fas fa-home' style='font-size:.9em;' ></i>
  </a>&#8239;
  <a href='mailto:therbootcamp@gmail.com'>
    <i class='fas fa-envelope' style='font-size: .9em;'></i>
  </a>&#8239;
  <a href='https://www.linkedin.com/company/basel-r-bootcamp/'>
    <i class='fab fa-linkedin' style='font-size: .9em;'></i>
  </a>"
date: "März 2020"
output:
  xaringan::moon_reader:
    css: ["default", "baselrbootcamp.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
---

layout: true

<div class="my-footer">
  <span style="text-align:center">
    <span> 
      <img src="https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/by-sa.png" height=14 style="vertical-align: middle"/>
    </span>
    <a href="https://therbootcamp.github.io/">
      <span style="padding-left:82px"> 
        <font color="#7E7E7E">
          www.therbootcamp.com
        </font>
      </span>
    </a>
    <a href="https://therbootcamp.github.io/">
      <font color="#7E7E7E">
       Statistik mit R | März 2020
      </font>
    </a>
    </span>
  </div> 

---

```{r, eval = TRUE, echo = FALSE, warning=F,message=F}
# Code to knit slides

```

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
options(width = 110)
options(digits = 4)

# Load packages
require(tidyverse)

print2 <- function(x, nlines=10,...) {
   cat(head(capture.output(print(x,...)), nlines), sep="\n")}

# Load data
baselers <- readr::read_csv("1_Data/baselers.csv")

# get color palette functions
source("../../_materials/palette/therbootcamp_palettes.R")
colors = baselrbootcamp_colors

knitr::opts_chunk$set(dpi = 300, echo = FALSE, warning = FALSE, fig.align = 'center')
```


# Linear Models

.pull-left5[

Linear models are, by far, <high>the most important models in all of statistics</high>.

Many statistical tests you may know of are special types of linear models.

Why are linear models so great?

- They are <high>easy to interpret</high>.
- They can <high>approximate non-linear</high> data well.
- They are <high>easy to calculate</high> and implement (just addition and multiplication!).
- They <high>just work</high>!

]

.pull-right45[


cartoon

]

---

# Zusammenhänge


simple zusammenhänge

Korrelationscoeffizient


```{r, echo = FALSE, fig.width = 3.5, fig.height = 3}

mod <- lm(income ~ age, data = baselers)
my_coef <- coef(mod)

simple_scatter <- ggplot(baselers %>% filter(age < 80) %>% slice(1:30), aes(age, income)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = baselrbootcamp_cols("magenta")) +
  theme_bw()

simple_scatter
```


---

# Einfache Lineare Regression

.pull-left45[


<high>Definition</high>: Simple linear regression is a linear model with one predictor $x$, and where the error term $\epsilon$ is Normally distributed.


<br>

$$\huge y=\beta_{0} + \beta_{1} x + \epsilon$$

<br>

<table style="cellspacing:0; cellpadding:0; border:none" width=100%>
  <col width="30%">
  <col width="30%">
  <col width="40%">
<tr>
  <td bgcolor="white">
    <b>Parameter</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
  <td bgcolor="white">
    <b>In words</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    &#x3B2;<sub>0</sub>
  </td>
  <td bgcolor="white">
    Intercept
  </td> 
  <td bgcolor="white">
    When x = 0, what is the predicted value for y?
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    &#x3B2;<sub>1</sub>
  </td>
  <td bgcolor="white">
    Coefficient for x
  </td> 
  <td bgcolor="white">
    For every increase of 1 in x, how does y change?
  </td> 
</tr>
</table>


]


.pull-right45[


```{r, echo = FALSE, fig.width = 3.5, fig.height = 2.5, out.width = "70%"}

simple_scatter
```

<center><u>Formula</u></center>

$$\Large income = 885 + 149.3 \times age  + \epsilon$$

<center><u>Coefficients</u></center>

$$\Large \beta_{0} = 885, \beta_{age} = 149.3$$

]


---

# Lösungen für b0 und für b1


---

# Least squares

Residuale


---

# Least squares

---

# R-squared


---

# Multiple Linear Regression

.pull-left5[

<high>Definition</high>: Multiple linear regression is a linear model with many predictors $x_{1},  x_{2}, .... x_{n}$, and where the error term $\epsilon$ is Normally distributed.

<br>

$$\LARGE y=\beta_{0} + \beta_{1}x_{1} + \beta_{2} x_{2}+...+ \beta_{n} x_{n} + \epsilon$$
<br>

<table style="cellspacing:0; cellpadding:0; border:none" width=100%>
  <col width="25%">
  <col width="25%">
  <col width="50%">
<tr>
  <td bgcolor="white">
    <b>Parameter</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
  <td bgcolor="white">
    <b>In words</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    &#x3B2;<sub>0</sub>
  </td>
  <td bgcolor="white">
    Intercept
  </td> 
  <td bgcolor="white">
    When all x values are 0, what is the predicted value for y?
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    &#x3B2;<sub>1</sub>, &#x3B2;<sub>2</sub>, ...
  </td>
  <td bgcolor="white">
    Coefficient for x<sub>1</sub>, x<sub>2</sub>, ...
  </td> 
  <td bgcolor="white">
     For every increase of 1 in coefficient for x<sub>1</sub>, x<sub>2</sub>, ... how does y change?
  </td> 
</tr>
</table>


]


.pull-right45[


```{r, echo = FALSE, fig.width = 5, fig.height = 2.25, out.width = "100%"}
mod_2 <- glm(income ~ age + height, data = baselers %>% filter(age < 80) %>% slice(1:30))

coef_2 <- coef(mod_2)

p1 <- ggplot(baselers %>% filter(age < 80) %>% slice(1:30), aes(age, income)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = baselrbootcamp_cols("magenta")) +
  theme_bw()

p2 <- ggplot(baselers %>% filter(age < 80) %>% slice(1:30), aes(height, income)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = baselrbootcamp_cols("magenta")) +
  theme_bw()

ggpubr::ggarrange(p1, p2, ncol = 2, nrow = 1)


```

<br><center><u>Formula</u></center>

$$\large income = 1628 + 147  \times age - 4.1 \times height + \epsilon$$

<center><u>Coefficients</u></center>

$$\large \beta_{0} = 1628, \beta_{age} = 147, \beta_{weight}=-4.1$$


]


---

# Lösungen für b0 und für b1 ...bn


---

# Datenmodell -> Normalverteilung


---

# Teststatistik und verteilung


---

# Lineare modelle mit R


---

# Formulas


---

# Output


---

# Helper functions



---

# Estimating coefficients

.pull-left45[

How do we estimate the 'right' coefficients in a linear model? <high>Which of the four would be a good fit?</high>

```{r, fig.width = 2.5, fig.height = 2}
data <- baselers %>% 
  filter(age < 80) %>% 
  slice(1:5) %>%
  select(age, income) %>%
  mutate(income = income / 1000) %>%
  arrange(age)

mod <- lm(income ~ age, data = data)
my_coef <- coef(mod)

a_slope <- -.1
a_intercept <- 12

b_slope <-  round(my_coef[2], 3)
b_intercept <- round(my_coef[1], 3)

c_slope <- .11
c_intercept <- 2

d_slope <- 0
d_intercept <- 7


data <- data %>%
  mutate(a = a_intercept + a_slope * age,
         b = b_intercept + b_slope * age,
         c = c_intercept + c_slope * age,
         d = d_intercept + d_slope * age,
         a_se = (a - income) ^ 2,
         b_se = (b - income) ^ 2,
         c_se = (c - income) ^ 2,
         d_se = (d - income) ^ 2)


p <- ggplot(data, aes(age, income)) +
  geom_point(size = 2) +
  theme_bw()

a <- p + geom_abline(slope = a_slope, intercept = a_intercept, col = baselrbootcamp_cols("grey"), size = 1.5, alpha = .8) + labs(title = "A", subtitle = paste0("B_0 = ", a_intercept, ", B_age = ", a_slope))

b <- p + geom_abline(slope = b_slope, intercept = b_intercept, col = baselrbootcamp_cols("grey"), size = 1.5, alpha = .8) + labs(title = "B", subtitle = paste0("B_0 = ", b_intercept, ", B_age = ", b_slope))

c <- p +  geom_abline(slope = c_slope, intercept = c_intercept, col = baselrbootcamp_cols("grey"), size = 1.5, alpha = .8)+ labs(title = "C", subtitle = paste0("B_0 = ", c_intercept, ", B_age = ", c_slope))

d <- p +  geom_abline(slope = d_slope, intercept = d_intercept, col = baselrbootcamp_cols("grey"), size = 1.5, alpha = .8)+ labs(title = "D", subtitle = paste0("B_0 = ", d_intercept, ", B_age = ", d_slope))


```


```{r, fig.width = 3, fig.height = 2.5, out.width = "80%"}
p+ labs(title = "?", subtitle = "B_0 = ?, B_age = ?")
```

$$\Large income = \beta_{0} + \beta_{1} \times age + \epsilon$$
]

.pull-right5[

```{r, fig.width = 5, fig.height = 4.5, out.width = "95%"}

ggpubr::ggarrange(a, b, c, d, ncol = 2, nrow = 2)

```

]



---

# Estimating coefficients

.pull-left45[

How do we estimate the 'right' coefficients in a linear model? <high>Which of the four would be a good fit?</high>

```{r, fig.width = 2.5, fig.height = 2}
a <- a + annotate(geom = "segment", x = data$age, y = data$income, xend = data$age,  yend = data$a, col = baselrbootcamp_cols("magenta"))

b <- b + annotate(geom = "segment", x = data$age, y = data$income, xend = data$age,  yend = data$b, col = baselrbootcamp_cols("magenta"))

c <- c + annotate(geom = "segment", x = data$age, y = data$income, xend = data$age,  yend = data$c, col = baselrbootcamp_cols("magenta"))

d <- d + annotate(geom = "segment", x = data$age, y = data$income, xend = data$age,  yend = data$d, col = baselrbootcamp_cols("magenta"))

```

```{r, fig.width = 3, fig.height = 2.5, out.width = "80%"}
p+ geom_abline(slope = my_coef[2], intercept = my_coef[1], col = baselrbootcamp_cols("grey"), size = 1.5, alpha = .8) + 
  labs(title = "B", subtitle = paste0("B_0 = ", b_intercept, ", B_age = ", b_slope)) +
  annotate(geom = "segment", x = data$age, y = data$income, xend = data$age,  yend = data$b, col = baselrbootcamp_cols("magenta"))
```

$$\Large income = -0.254 + 0.167 \times age + \epsilon$$
]

.pull-right5[


```{r, fig.width = 5, fig.height = 4.5, out.width = "95%"}

ggpubr::ggarrange(a, b, c, d, ncol = 2, nrow = 2)

```

]


---



.pull-left45[

# Estimating coefficients

How do we estimate the 'right' coefficients in a linear model?

Find the values that minimise <high>Mean Squared Error</high> (MSE).

MSE:  The average squared distance between the prediction and the data.

<br>

$$\Large MSE = \frac{1}{N}\sum_{i=1}^{n}(y_{i}-  Prediction_{i})^2$$
<!-- $$\LARGE = \frac{1}{N}\sum_{i=1}^{n}(Y_{i}-  (\beta_{0} + \beta_{1}x_{1}))^2$$ -->


]

.pull-right5[

<br>

```{r, fig.width = 3.5, fig.height = 2.65, out.width = "67%"}
p+ geom_abline(slope = my_coef[2], intercept = my_coef[1], col = baselrbootcamp_cols("grey"), size = 1.5, alpha = .8) + 
  labs(title = "B", subtitle = paste0("B_0 = ", b_intercept, ", B_age = ", b_slope)) +
  annotate(geom = "segment", x = data$age, y = data$income, xend = data$age,  yend = data$b, col = baselrbootcamp_cols("magenta"))
```

```{r, results = "as.is", eval = FALSE}
data %>%
  select(age, income, Prediction = b) %>%
  mutate(SE = (income - Prediction) ^ 2) %>%
  mutate(id = 1:5) %>% select(id, everything()) %>%
  slice(1:5) %>%
  knitr::kable()
```

| id| age| income| Prediction|     SE|
|--:|---:|------:|----------:|------:|
|  1|  24|    4.0|      3.730| 0.0729|
|  2|  27|    4.2|      4.228| 0.0008|
|  3|  31|    5.1|      4.892| 0.0433|
|  4|  44|    6.3|      7.050| 0.5625|
|  5|  65|   10.9|     10.536| 0.1325|
|  |  |   |      <b>MSE</b>| <b>0.16</b>|


]

---

# R<sup>2</sup> (R-Squared)

.pull-left45[

R-Squared $R^{2}$ is the most common method of calculating the <high>overall performance</high> of a model.

<br>

$$\huge R^{2} = 1 - \frac{SS_{res}}{SS_{tot}}$$


<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="15%">
  <col width="85%">
<tr>
  <td bgcolor="white">
    <b>R<sup>2</sup></b>
  </td>
  <td bgcolor="white">
    <b>Interpretation</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    0
  </td>
  <td bgcolor="white">
    Model explains no variance in y.
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   .5
  </td>
  <td bgcolor="white">
    Model explains half the variance in y.
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   1
  </td>
  <td bgcolor="white">
    Model explains <i>all</i> half the variance in y.
  </td> 
</tr>
</table>

]

.pull-right5[

<p align="center"> 
  <img src="image/r2_vis.png">
  <font style="font-size:10px"> from <a   href='https://en.wikipedia.org/wiki/Coefficient_of_determination'>Wikipedia</a></font>
  </a>
</p>
]

---

# R<sup>2</sup> (R-Squared)

.pull-left45[

R-Squared $R^{2}$ is the most common method of calculating the <high>overall performance</high> of a model.

<br>

$$\huge R^{2} = 1 - \frac{SS_{res}}{SS_{tot}}$$


<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="15%">
  <col width="85%">
<tr>
  <td bgcolor="white">
    <b>R<sup>2</sup></b>
  </td>
  <td bgcolor="white">
    <b>Interpretation</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    0
  </td>
  <td bgcolor="white">
    Model explains no variance in y.
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   .5
  </td>
  <td bgcolor="white">
    Model explains half the variance in y.
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   1
  </td>
  <td bgcolor="white">
    Model explains <i>all</i> half the variance in y.
  </td> 
</tr>
</table>

]

.pull-right5[

<p align="center"><i>2 Models with different R2 values</i></p>

```{r, fig.width = 5, fig.height = 3, out.width = "100%"}
set.seed(100)
data <- data %>%
  mutate(height = income * 8 + rnorm(5, mean = 0, sd = 40))

age_mod <- glm(income ~ age, data = data)
height_mod <- glm(income ~ height, data = data)

data <- data %>%
  mutate(age_pred = fitted(age_mod),
         height_pred = fitted(height_mod))

r2_age <- rsq::rsq(lm(income ~ age, data = data))

mse_age <- age_mod %>% resid() %>% `^`(2) %>% mean()
  
r2_height<- rsq::rsq(lm(income ~ height, data = data))

mse_height <- glm(income ~ height, data = data) %>% resid() %>% `^`(2) %>% mean()


a <- ggplot(data, aes(x = age, y = income)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = baselrbootcamp_cols("grey")) +
  labs(title = paste0("R2 = ", round(r2_age, 2), ", MSE = ", round(mse_age, 2))) +
  annotate("segment", x = data$age, y = data$income, xend = data$age, yend = data$age_pred, col = baselrbootcamp_cols("magenta")) +
  theme_bw()

b <- ggplot(data, aes(x = height, y = income)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE,col = baselrbootcamp_cols("grey")) + 
  labs(title = paste0("R2 = ", round(r2_height, 2), ", MSE = ", round(mse_height, 2))) +
    annotate("segment", x = data$height, y = data$income, xend = data$height, yend = data$height_pred, col = baselrbootcamp_cols("magenta")) +
  theme_bw()

ggpubr::ggarrange(b, a, ncol = 2, nrow = 1)

```

]

---
class: middle, center

# How to fit and and dissect linear models in R

## with `glm()`

---

# Key Functions

.pull-left35[

<font style="font-size:20px"><u>Fitting</u></p>

<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="40%">
  <col width="60%">
<tr>
  <td bgcolor="white">
    <b>Function</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    <mono>glm(formula, data)</mono>
  </td>
  <td bgcolor="white">
    Fit a linear model to data and calculate best coefficients
  </td> 
</tr>
</table>

<font style="font-size:20px"><u>Evaluation</u></p>

<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="40%">
  <col width="60%">
<tr>
  <td bgcolor="white">
    <b>Function</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>coef(mod)</mono>
  </td>
  <td bgcolor="white">
    Get coefficients from a model
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>fitted(mod)</mono>
  </td>
  <td bgcolor="white">
    Get fitted results.
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>resid(mod)</mono>
  </td>
  <td bgcolor="white">
    Get residuals (errors)
  </td> 
</tr>
</table>

]

.pull-right6[

```{r, echo = TRUE}
# Create a model income_glm

# Y = income
# X1 = age, X2 = children

income_glm <- glm(formula = income ~ age + children,
                  data = baselers)
```

<br>

| id| income| age| children|
|--:|------:|---:|--------:|
|  1|   6300|  44|        2|
|  2|  10900|  65|        2|

]


---

# Key Functions

.pull-left35[


<font style="font-size:20px"><u>Fitting</u></p>

<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="40%">
  <col width="60%">
<tr>
  <td bgcolor="white">
    <b>Function</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    <mono>glm(formula, data)</mono>
  </td>
  <td bgcolor="white">
    Fit a linear model to data and calculate best coefficients
  </td> 
</tr>
</table>

<font style="font-size:20px"><u>Evaluation</u></p>

<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="40%">
  <col width="60%">
<tr>
  <td bgcolor="white">
    <b>Function</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>coef(mod)</mono>
  </td>
  <td bgcolor="white">
    Get coefficients from a model
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>fitted(mod)</mono>
  </td>
  <td bgcolor="white">
    Get fitted results.
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>resid(mod)</mono>
  </td>
  <td bgcolor="white">
    Get residuals (errors)
  </td> 
</tr>
</table>

]

.pull-right6[


```{r, echo = TRUE}
# Print income_glm

income_glm
```

]


---

# Key Functions

.pull-left35[

<font style="font-size:20px"><u>Fitting</u></p>

<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="40%">
  <col width="60%">
<tr>
  <td bgcolor="white">
    <b>Function</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    <mono>glm(formula, data)</mono>
  </td>
  <td bgcolor="white">
    Fit a linear model to data and calculate best coefficients
  </td> 
</tr>
</table>

<font style="font-size:20px"><u>Evaluation</u></p>

<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="40%">
  <col width="60%">
<tr>
  <td bgcolor="white">
    <b>Function</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>coef(mod)</mono>
  </td>
  <td bgcolor="white">
    Get coefficients from a model
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>fitted(mod)</mono>
  </td>
  <td bgcolor="white">
    Get fitted results.
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>resid(mod)</mono>
  </td>
  <td bgcolor="white">
    Get residuals (errors)
  </td> 
</tr>
</table>

]

.pull-right6[

```{r, echo = TRUE, eval = F}
# Show summary info
summary(income_glm)
```


```{r, echo = FALSE}
# Show summary info
print2(summary(income_glm),17)
```

]


---

# Key Functions

.pull-left35[

<font style="font-size:20px"><u>Fitting</u></p>

<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="40%">
  <col width="60%">
<tr>
  <td bgcolor="white">
    <b>Function</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    <mono>glm(formula, data)</mono>
  </td>
  <td bgcolor="white">
    Fit a linear model to data and calculate best coefficients
  </td> 
</tr>
</table>

<font style="font-size:20px"><u>Evaluation</u></p>

<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="40%">
  <col width="60%">
<tr>
  <td bgcolor="white">
    <b>Function</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>coef(mod)</mono>
  </td>
  <td bgcolor="white">
    Get coefficients from a model
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>fitted(mod)</mono>
  </td>
  <td bgcolor="white">
    Get fitted results.
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>resid(mod)</mono>
  </td>
  <td bgcolor="white">
    Get residuals (errors)
  </td> 
</tr>
</table>


]

.pull-right6[



```{r, echo = TRUE, eval = FALSE}
# Get fitted values (only first 5)
fitted(income_glm)

# Get residuals (only first 10)
resid(income_glm)
```

```{r, eval = TRUE, echo  =FALSE}
# Get fitted values (only first 5)
fitted(income_glm)[1:5]

# Get residuals (only first 10)
resid(income_glm)[1:5]
```

<br>

| id| income| age| children|<high>fitted</high>|<high>resid</high>|
|--:|------:|---:|:--------|:----|:-----|
|  1|   6300|  44|        2|7454|-1153.6|
|  2|  10900|  65|        2|10588|312.2|

]



---

# Key Functions

.pull-left35[

<font style="font-size:20px"><u>Fitting</u></p>

<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="40%">
  <col width="60%">
<tr>
  <td bgcolor="white">
    <b>Function</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
    <mono>glm(formula, data)</mono>
  </td>
  <td bgcolor="white">
    Fit a linear model to data and calculate best coefficients
  </td> 
</tr>
</table>

<font style="font-size:20px"><u>Evaluation</u></p>

<table style="cellspacing:0; cellpadding:0; border:none; padding-top:10px" width=100%>
  <col width="40%">
  <col width="60%">
<tr>
  <td bgcolor="white">
    <b>Function</b>
  </td>
  <td bgcolor="white">
    <b>Description</b>
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>rsq(mod)</mono>
  </td>
  <td bgcolor="white">
    Get R<sup>2</sup> value from model.
  </td> 
</tr>
<tr>
  <td bgcolor="white">
   <mono>tidy(mod)</mono>
  </td>
  <td bgcolor="white">
    Get tidy results from a model.
  </td> 
</tr>
</table>

]

.pull-right6[

```{r, echo = TRUE}
library(rsq)
library(broom)

# Show R-squared from model
rsq(income_glm)

# Show 'tidy' results from my model
tidy(income_glm)
```

]




---

# What is a linear model?

.pull-left5[

A linear model is <high>just addition and multiplication</high> and can be written in the following forms: 

<br>

<center><u>Version 1</u><center>

$$\huge y = \beta_{0} + \beta_{1}x_{1} + \beta_{2} x_{2} +  ... + \beta_{n}x_{n} + \epsilon$$

<br>

<center><u>Version 2</u><center>


$$\huge y = \beta_{0} + \sum_{i=1}^{n}\beta_{i}x_{i}+ \epsilon$$


]


.pull-right4[

<p align = "center">
  <img src="image/math.jpg"><br>
  <font style="font-size:10px">
    from <a href="https://66.media.tumblr.com/6e401f0cffebf9c7440894d4fa6c48b2/tumblr_o0af44kS071u7w7kwo1_1280.jpg"> media.tumblr.com</a>
  </font>
</p>

]



---

class: middle, center

<h1><a href="https://therbootcamp.github.io/SwR_2019Apr/_sessions/LinearModelsI/LinearModelsI_practical.html">Practical</a></h1>

