<!DOCTYPE html>
<html>
  <head>
    <title>Mixed Effects Models</title>
    <meta charset="utf-8">
    <meta name="author" content="Statistics with R   Basel R Bootcamp" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="baselrbootcamp.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Mixed Effects Models
### Statistics with R<br> <a href='https://therbootcamp.github.io'> Basel R Bootcamp </a> <br> <a href='https://therbootcamp.github.io/SwR_2019Apr/'> <i class='fas fa-clock' style='font-size:.9em;'></i> </a>  <a href='https://therbootcamp.github.io'> <i class='fas fa-home' style='font-size:.9em;' ></i> </a>  <a href='mailto:therbootcamp@gmail.com'> <i class='fas fa-envelope' style='font-size: .9em;'></i> </a>  <a href='https://www.linkedin.com/company/basel-r-bootcamp/'> <i class='fab fa-linkedin' style='font-size: .9em;'></i> </a>
### April 2019

---


layout: true

&lt;div class="my-footer"&gt;
  &lt;span style="text-align:center"&gt;
    &lt;span&gt; 
      &lt;img src="https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/by-sa.png" height=14 style="vertical-align: middle"/&gt;
    &lt;/span&gt;
    &lt;a href="https://therbootcamp.github.io/"&gt;
      &lt;span style="padding-left:82px"&gt; 
        &lt;font color="#7E7E7E"&gt;
          www.therbootcamp.com
        &lt;/font&gt;
      &lt;/span&gt;
    &lt;/a&gt;
    &lt;a href="https://therbootcamp.github.io/"&gt;
      &lt;font color="#7E7E7E"&gt;
       Statistics with R | April 2019
      &lt;/font&gt;
    &lt;/a&gt;
    &lt;/span&gt;
  &lt;/div&gt; 

---








# [iid](https://en.wikipedia.org/wiki/Independent_and_identically_distributed_random_variables) Assumption

.pull-left45[
Previous regression models assumed that the data points are independent and identically distributed (&lt;high&gt;iid&lt;/high&gt;).

* Independent: The occurrence of one value does not affect the occurrence of another value.
* Identically distributed: All data points stem from the same probability distribution.


]

.pull-right45[

picture for one (ratings of action movies by different persons)

picture for distribution (picture of normal distribution from which values are sampled)


]

---

# Data Example

.pull-left45[
repeated measures example that shows that data points are not independent
-&gt; classical statistical procedures are not robutst to violations of independence

we need to controll for this and can do so by using mixed effects models
fixed and random effects

possibilities:
- complete pooling -&gt; ignore dependency in data (e.g. averaging) -&gt; check
- no pooling -&gt; fit separate regressions to each participant separately
- partial pooling -&gt; compromise done in mixed effects models (-&gt; check details again)

the data we will use

subjects rate action movies and someone wants to find out how alcohol influences these ratings
movie ratings when sober and after two beers
same movies rated multiple times

]

.pull-right45[

&lt;img src="image/dat_plot.png" width="6400" /&gt;


]

---

# Mixed Effects

.pull-left45[
Mixed effects models combine two kinds of effects that serve different purposes:

* &lt;high&gt;Fixed effects&lt;/high&gt;
* &lt;high&gt;Random effects&lt;/high&gt;


]

.pull-right45[

mixed effects model example picture

]

---

# Fixed Effects

.pull-left45[
Fixed effects represent the overall effect (main effect or interaction) of a predictor.

So far we only considered "fixed effects only" models.


]

.pull-right45[


&lt;img src="image/FE_plot.png" width="6400" /&gt;


]

---

# Random Effects

.pull-left45[
With random effects, we can account for random variability in the data that comes from different sources.

Random effects:

* are often part of what we want to generalize over
* are always categorical variables

As expressed by [Singmann and Kellen](http://davidkellen.org/wp-content/uploads/2017/04/introduction-mixed-models.pdf):

&gt; By specifying random effects in our model, we are able to factor out the idiosyncasies of our sample and obtain a more general estimate of the fixed effects of interest.


]

.pull-right45[

&lt;img src="image/dat_plot.png" width="6400" /&gt;


]

---

# Fixed Effects Only Model - Math

&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;img src="image/FE_only.png" width="80%" style="display: block; margin: auto;" /&gt;


---

# Fixed Effects Only Model - Data Example

&lt;img src="image/FE_plot.png" width="70%" style="display: block; margin: auto;" /&gt;




---

# Random Intercepts Model - Math

&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;img src="image/RI_only.png" width="80%" style="display: block; margin: auto;" /&gt;


---

# Random Intercepts Model - Data Example

.pull-left45[


&lt;img src="image/subj_RI_plot.png" width="100%" style="display: block; margin: auto;" /&gt;
&lt;figcaption align = "center" style="display: block; margin: auto;"&gt;By-Subject Random Intercepts&lt;/figcaption&gt;


]

.pull-right45[


&lt;img src="image/mov_RI_plot.png" width="100%" style="display: block; margin: auto;" /&gt;
&lt;figcaption align = "center" style="display: block; margin: auto;"&gt;By-Movie Random Intercepts&lt;/figcaption&gt;


]



---

# Random Intercepts and Slopes Model - Math

&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;img src="image/RI_RS.png" width="80%" style="display: block; margin: auto;" /&gt;


---

# Random Intercepts and Slopes Model - Data Example

.pull-left45[


&lt;img src="image/subj_RI_RS_plot.png" width="100%" style="display: block; margin: auto;" /&gt;
&lt;figcaption align = "center" style="display: block; margin: auto;"&gt;By-Subject Random Intercepts and Slopes&lt;/figcaption&gt;


]

.pull-right45[


&lt;img src="image/mov_RI_RS_plot.png" width="100%" style="display: block; margin: auto;" /&gt;
&lt;figcaption align = "center" style="display: block; margin: auto;"&gt;By-Movie Random Intercepts and Slopes&lt;/figcaption&gt;


]



---

# Crossed Random Effects Model - Math

&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;img src="image/Cr_RI_RS.png" width="80%" style="display: block; margin: auto;" /&gt;


---

# Crossed Random Effects Model - Data Example

&lt;img src="image/cr_RI_RS_plot.png" width="70%" style="display: block; margin: auto;" /&gt;


---

# Nested Random Effects

.pull-left45[
nested vs crossed random effects

]

.pull-right45[


]

---

# Estimating Random Effects

.pull-left45[

shrinkage

variance is estimated

person intercepts are posteriors

]

.pull-right45[

picture of data with fixed effects model

]
---

# Keep It Maximal

.pull-left45[
Always justify the maximal random effects structure justified by the design [Barr et al., 2014](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3881361/pdf/nihms533954.pdf)

]

.pull-right45[


]

---

# Fitting Mixed Effects Models in R

.pull-left45[
fitting LMEMs in R
lme4
afex
rstanarm
-&gt; provide table with functions from the packages to use for LMEM

| Package| Function|
|:------|:----|
| &lt;high&gt;lme4&lt;/high&gt;| `glmer()` / `lmer()`|
| &lt;high&gt;afex&lt;/high&gt;| `mixed()`|
| &lt;high&gt;rstanarm&lt;/high&gt;| `stan_glmer()` / `stan_lmer()` |


]

.pull-right45[


]

---

# Specifying Random Effects in &lt;high&gt;lme4&lt;/high&gt;



Random effects are specified with a new element to the formulas:


| Formula | Meaning |
|:------|:----|
| `(1 `&amp;#124;` S)` | Random intercepts by `S` |
| `(1 `&amp;#124;` S) + (1 `&amp;#124;` I)` | Random intercepts by `S` and `I`|
| `(X1 `&amp;#124;` S)` / `(1 + X1`&amp;#124;` S)`| Random intercepts by `S` and random slopes for `X1` by `S` with correlations  |
| `(X1 * X2 `&amp;#124;` S)`| Random intercepts by `S` and random slopes for `X1`, `X2`, and their interaction `X1:X2` by `S` with correlations  |
| `(0 + X1 `&amp;#124;` S)`| Random slopes for `X1`by `S`, no random intercepts |
| `(X1 `&amp;#124;&amp;#124;` S)`| Random intercepts by `S` and random slopes for `X1` by `S` no correlations |


---

# Regression &lt;i&gt;applied&lt;/i&gt;

.pull-left45[
other error distributions and link functions

]

.pull-right45[


]
---

class: middle, center

&lt;h1&gt;&lt;a href="https://therbootcamp.github.io/SwR_2019Apr/_sessions/RegressionI/RegressionI_practical.html"&gt;Practical&lt;/a&gt;&lt;/h1&gt;
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
