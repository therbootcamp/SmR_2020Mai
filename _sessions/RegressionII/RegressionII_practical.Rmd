---
title: "Regression <i>applied</i>"
author: "<table style='table-layout:fixed;width:100%;border:0;padding:0;margin:0'><col width='10%'><col width='10%'>
  <tr style='border:none'>
    <td style='display:block;width:100%;text-align:left;vertical-align:bottom;padding:0;margin:0;border:none' nowrap>
      <font style='font-style:normal'>Statistics with R</font><br>
      <a href='https://therbootcamp.github.io/SWR_2019Apr/'>
        <i class='fas fa-clock' style='font-size:.9em;' ></i>
      </a>
      <a href='https://therbootcamp.github.io'>
        <i class='fas fa-home' style='font-size:.9em;'></i>
      </a>
      <a href='mailto:therbootcamp@gmail.com'>
        <i class='fas fa-envelope' style='font-size: .9em;'></i>
      </a>
      <a href='https://www.linkedin.com/company/basel-r-bootcamp/'>
        <i class='fab fa-linkedin' style='font-size: .9em;'></i>
      </a>
      <a href='https://therbootcamp.github.io'>
        <font style='font-style:normal'>Basel R Bootcamp</font>
      </a>
    </td>
    <td style='width:100%;vertical-align:bottom;text-align:right;padding:0;margin:0;border:none'>
      <img src='https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/by-sa.png' style='height:15px;width:80px'/>
    </td>
  </tr></table>"
output:
  html_document:
    css: practical.css
    self_contained: no
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(comment = NA, 
                      fig.width = 6, 
                      fig.height = 6,
                      fig.align = 'center',
                      echo = FALSE, 
                      eval = FALSE, 
                      warning = FALSE)

options(digits = 3)

# Load packages
library(tidyverse)



trial <- read_csv(file = "1_Data/trial_ACTG175.csv")

```

<p align="center" width="100%">
  <img src="https://www.infogrades.com/wp-content/uploads/2016/07/Interesting-Facts-about-McDonalds-Fast-Food.jpg" alt="Trulli" style="width:100%">
  <br>
  <font style="font-size:10px">from <a href="">shortened URL</a></font>
</p>


# {.tabset}

## Overview

In this practical you'll practice applications of regression

By the end of this practical you will know how to:

1. Conduct a t-test (one sample, two sample, and paired)
2. Conduct a correlation test
3. Conduct an ANVOA
4. Conduct a chi-square test

## Tasks

### A - Setup

1. Open your `BaselRBootcamp` R project. It should already have the folders `1_Data` and `2_Code`. Make sure that the data files listed in the `Datasets` section above are in your `1_Data` folder

```{r}
# Done!
```

2. Open a new R script. At the top of the script, using comments, write your name and the date. Save it as a new file called `wrangling_practical.R` in the `2_Code` folder.  

```{r}
# Done!
```

3. Using `library()` load the `tidyverse` package (if you don't have it, you'll need to install it with `install.packages()`)!

```{r, echo = TRUE, eval = FALSE}
# Load packages necessary for this script
library(tidyverse)
library(broom)
```

4. Using the following template, load the `trial_ACTG175.csv` data into R and store it as a new object called `trial` (Hint: Don't type the path directly! Use the "tab" completion!).

```{r, echo = TRUE}
# Load trial_ACTG175.csv from the 1_Data folder as a new object called trial

XX <- read_csv(file = "XX/XX")
```

```{r}
# Load trial_act.csv from the 1_Data folder

trial <- read_csv(file = "1_Data/trial_ACTG175.csv")
```

5. Take a look at the first few rows of the dataset(s) by printing it/them to the console, it should look like the table below:

```{r, eval = TRUE, echo = FALSE}
knitr::kable(trial %>% slice(1:5))
```

```{r, echo = TRUE}
# Print XXX object
XXX
```

```{r}
trial
```

7. Use the the `summary()` function to print more details on the columns of the datasets.

```{r}
summary(XXX)
```

```{r}
summary(trial)
```

8. Use the `View()` function to view the entire dataframe(s) in window(s)

```{r, echo = TRUE, eval = FALSE}
View(XXX)
```

```{r, eval = FALSE}
View(trial)
```

### B - Correlation

> Research Question:
> Is there a correlation between a patient's age and their CD4 T cell count at baseline?

1. Using the code below, create a plot showing the relationship between age and CD4 T cell count at baseline. Based on this plot, do you expect to find a relationship bewteen the two variables?

```{r, eval = FALSE, echo = TRUE}
ggplot(data = trial, mapping = aes(x = age, y = cd40)) + 
      geom_point(alpha = .1) +
  labs(title = "ACTG175 Trial",
       subtitle = "Baseline age and CD4 T cell count at baseline ",
       x = "Age (age)",
       y = "CD4 T cell count at baseline (cd40)")
```

2. Using the `cor.test()` function, create an object called `age_cd40_test` which conducts a correlation test between a patient's age at baseline (`age`) and their CD4 T cell count at baseline (`cd40`)

```{r, eval = FALSE, echo = TRUE}
# Correlation between patient's age at baseline and CD4 T cell count at baseline

XXX <- cor.test(formula = ~ XXX + XXX,
                data = XXX)
```

```{r}
# Correlation between patient's age at baseline and CD4 T cell count at baseline

age_cd40_test <- cor.test(formula = ~ age + cd40,
                          data = trial)
```

3. Print the `age_cd40_test` object to see summary outputs.

```{r}
age_cd40_test
```

4. Apply the `names()` function to your `age_cd40_test` object to see all of its named elements

```{r}
# See all named elements of age_cd40_test
names(XXX)
```

```{r}
# See all named elements of age_cd40_test
names(age_cd40_test)
```

5. Using the `XXX$XXX` notation, print only the correlation estimate (`estimate`) in your `age_cd40_test` object. What does this value tell you?

```{r}
# Print correlation coefficient estimate in the age_cd40_test object
XXX$XXX
```

```{r}
# Print correlation coefficient estimate
age_cd40_test$estimate
```

6. Again using the `XXX$XXX` notation, print only the p value (`p.value`) in your `age_cd40_test` object. What does this value tell you?

```{r}
# Print the p value of the correlation coefficient in the age_cd40_test object
XXX$XXX
```

```{r}
# Print the p value in the age_cd40_test object
age_cd40_test$conf.int
```

7. Again using the `XXX$XXX` notation, print only the confidence interval (`conf.int`) in your `age_cd40_test` object. What does this value tell you?

```{r}
# Print the confidence interval of the correlation coefficient in the age_cd40_test object
XXX$XXX
```

```{r}
# Print the confidence interval in the age_cd40_test object
age_cd40_test$conf.int
```

8. Using the `tidy()` function (from the `broom` package), create a 'tidy' version of your `age_cd40_test` object called `age_cd420_tidy`

```{r}
# Create a 'tidy' version of my age_cd40_test object

age_cd420_tidy <- tidy(xxx)
```

```{r}
# Create a 'tidy' version of my age_cd40_test object

age_cd420_tidy <- tidy(age_cd40_test)
```

9. Now, print your `age_cd420_tidy` object, how do the results look?

```{r}
age_cd420_tidy
```

#### Correlation vs. Simple Regression

10. Conduct the same analysis you did before, but this time use the `glm()` function. Use the code skeleton below to help you. Do you get the same results as you did using `cor.test()`?

```{r, eval = FALSE, echo = TRUE}
# GLM predicting a patient's CD4 T cell count at baseline form their age at baseline 
age_cd40_glm <- glm(formula = XXX ~ XXX,
                    data = XXX)

# Print 'tidy' results
tidy(XXX)
```

```{r}
# GLM predicting a patient's CD4 T cell count at baseline form their age at baseline 
age_cd40_glm <- glm(formula = cd40 ~ age,
                    data = trial)

# Print 'tidy' results
tidy(age_cd40_glm)
```

### C - T-test

> Research Question:
> Do patients with a history of intravenous drug use have higher CD4 T cell counts at baseline compared to patients without a history of intraveneous drug use?

1. Using the code below, create a plot showing the distribution of CD4 T cell counts at baseline (`cd40`) depending on whether or not patients were symptomatic. Based on this plot, do you expect to find that symptomatic patients generally have higher (or lower) CD4 T cell counts?

```{r, eval= FALSE, echo = TRUE}
ggplot(data = trial, mapping = aes(x = symptom, y = cd40)) + 
  stat_summary(geom = "bar", fun.y = "mean", fill = "white", col = "black") +
  geom_jitter(width = .2, alpha = .1) +
  labs(title = "ACTG175 Trial",
       subtitle = "Baseline CD4 T cell count and symptoms",
       x = "Are patients symptomatic? (symptom)",
       y = "CD4 T cell count at baseline (cd40)")
```

2. Using the `t.test()` function, create an object called `symptom_cd40_test` which conducts a two-sample t-test comparing patients' CD4 T cell count at baseline (`cd40`) between patients that are symptomatic and those that are not (`symptomatic`)

```{r, eval = FALSE, echo = TRUE}
# T-test comparing CD4 T cell counts at baseline bewteen symptomatic and non-symptomatic patients

XXX <- t.test(formula = XXX ~ XXX,
              data = XXX)
```

```{r}
# T-test comparing CD4 T cell counts at baseline bewteen symptomatic and non-symptomatic patients

symptom_cd40_test <- t.test(formula = cd40 ~ symptom,
                           data = trial)
```

3. Print the `symptom_cd40_test` object to see summary outputs.

```{r}
age_cd40_test
```

4. Apply the `names()` function to your `symptom_cd40_test` object to see all of its named elements

```{r}
# See all named elements of symptom_cd40_test
names(XXX)
```

```{r}
# See all named elements of symptom_cd40_test
names(symptom_cd40_test)
```

5. Using the `XXX$XXX` notation, print only the correlation estimate (`estimate`) in your `symptom_cd40_test` object. What does the result tell you?

```{r}
# Print parameter estimates in the symptom_cd40_test object
XXX$XXX
```

```{r}
# Print parameter estimates in the symptom_cd40_test object
symptom_cd40_test$estimate
```

6. Again using the `XXX$XXX` notation, print only the p value (`p.value`) in your `symptom_cd40_test` object. What does this value tell you?

```{r}
# Print the p value of the symptom_cd40_test object
XXX$XXX
```

```{r}
# Print the p value in the symptom_cd40_test object
symptom_cd40_test$p.value
```

7. Again using the `XXX$XXX` notation, print only the confidence interval (`conf.int`) in your `symptom_cd40_test` object. What does this value tell you?

```{r}
# Print the confidence interval in the age_cd40_test object
XXX$XXX
```

```{r}
# Print the confidence interval in the age_cd40_test object
symptom_cd40_test$conf.int
```

8. Using the `tidy()` function (from the `broom` package), create a 'tidy' version of your `symptom_cd40_test` object called `symptom_cd40_tidy`

```{r}
# Create a 'tidy' version of my symptom_cd40_test object

symptom_cd40_tidy <- tidy(xxx)
```

```{r}
# Create a 'tidy' version of my age_cd40_test object

symptom_cd40_tidy <- tidy(symptom_cd40_test)
```

9. Now, print your `symptom_cd40_tidy` object, how do the results look?

```{r}
symptom_cd40_tidy
```

#### T-test vs. Simple Regression

10. Conduct the same analysis you did before, but this time use the `glm()` function. Use the code skeleton below to help you. Do you get the same results as you did using `t.test()`? Which outputs are the same and which are different?

```{r, eval = FALSE, echo = TRUE}
# GLM predicting a patient's CD4 T cell count at baseline form their age at baseline 
symptom_cd40_glm <- glm(formula = XXX ~ XXX,
                        data = XXX)

# Print 'tidy' results
tidy(XXX)
```

```{r}
# GLM predicting a patient's CD4 T cell count at baseline form their age at baseline 
symptom_cd40_glm <- glm(formula = cd40 ~ symptom,
                        data = trial)

# Print 'tidy' results
tidy(symptom_cd40_glm)
```

### D - ANOVA

> Research Question:
> Was there a difference between the treatment arms in the number of days until the first occurence of one of the following major negative events: (i) a decline in CD4 T cell count of at least 50 (ii) an event indicating progression to AIDS, or (iii) death?

1. Using the code below, create a plot showing the distribution of the number of days until a major negative event (`days`) for each treatment arm `arms` Based on this plot, do you expect to find that there were differences in treatment arms?

```{r, eval= FALSE, echo = TRUE}
ggplot(data = trial, mapping = aes(x = arms, y = days)) + 
  stat_summary(geom = "bar", fun.y = "mean", fill = "white", col = "black") +
  geom_jitter(width = .2, alpha = .1) +
  labs(title = "ACTG175 Trial",
       subtitle = "Baseline CD4 T cell count and symptoms",
       x = "Treatment Arm (arms)",
       y = "Number of days until a major negative event (days)")
```

2. Using the `t.test()` function, create an object called `symptom_cd40_test` which conducts a two-sample t-test comparing patients' CD4 T cell count at baseline (`cd40`) between patients that are symptomatic and those that are not (`symptomatic`)

```{r, eval = FALSE, echo = TRUE}
# T-test comparing CD4 T cell counts at baseline bewteen symptomatic and non-symptomatic patients

XXX <- t.test(formula = XXX ~ XXX,
              data = XXX)
```

```{r}
# ANOVA comparing number of days until a negative event between treatment arms

days_arms_aov <- aov(formula = days ~ arms,
                      data = trial)
```

3. Print the `days_arms_aov` object to see summary outputs.

```{r}
days_arms_aov
```

4. Apply the `names()` function to your `days_arms_aov` object to see all of its named elements

```{r}
# See all named elements of days_arms_aov
names(XXX)
```

```{r}
# See all named elements of symptom_cd40_test
names(days_arms_aov)
```

5. Using the `XXX$XXX` notation, print the coefficients in your `days_arms_aov` object. What do these values mean?

```{r}
# Print coefficients in the days_arms_aov object
XXX$XXX
```

```{r}
# Print coefficients in the days_arms_aov object
days_arms_aov$coefficients
```

7. Using the `tidy()` function (from the `broom` package), create a 'tidy' version of your `days_arms_aov` object called `days_arms_tidy`

```{r}
# Create a 'tidy' version of my symptom_cd40_test days_arms_aov

days_arms_tidy <- tidy(xxx)
```

```{r}
# Create a 'tidy' version of my days_arms_aov object

days_arms_tidy <- tidy(days_arms_aov)
```

9. Now, print your `days_arms_tidy` object, how do the results look?

```{r}
days_arms_tidy
```

#### Post-hoc tests

10. In order to compare pair-wise differences between groups after conducting an ANOVA, you need to conduct post-hoc tests. Using the `TukeyHSD()` function, conduct pair-wise tests to see which pairs of treatment arms differ in `days`. Save the result to an object called `days_arms_aov_post`
`
```{r, eval = FALSE, echo = TRUE}
# Conduct pair-wise tests comparing every pair of treatment
#  arms (arms) on days until a major negative event (days)

XXX <- TukeyHSD(XXX)
```

```{r, eval = FALSE, echo = TRUE}
# Conduct pair-wise tests comparing every pair of treatment
#  arms (arms) on days until a major negative event (days)

days_arms_aov_post <- TukeyHSD(days_arms_aov)
```

11. Print your `days_arms_aov_post` object, what do you see?

12. Print 'tidy' results from your `days_arms_aov_post` object using the `tidy()` function

```{r}
# Print 'tidy' version of days_arms_aov_post
tidy(XXX)
```

13. Based on what you've seen, what are your conclusions? Which treatment arms seem to differ?

#### ANOVA vs. Regression

10. Conduct the same analysis you did before, but this time use the `glm()` function. Use the code skeleton below to help you. Do you get the same results as you did using `aov()`? Which outputs are the same and which are different?

```{r, eval = FALSE, echo = TRUE}
# GLM predicting number of days until a major negative event (days) as a function of treatment arm (arms)
XXX <- glm(formula = XXX ~ XXX,
           data = XXX)

# Print object
XXX

# Print 'tidy' results
tidy(XXX)
```

```{r}
# GLM predicting number of days until a major negative event (days) as a function of treatment arm (arms)
days_arms_glm <- glm(formula = days ~ arms,
                     data = trial)

# Print object
days_arms_glm

# Print 'tidy' results
tidy(days_arms_glm)
```

#### E - You choose the test

### X - Advanced: XXX

#### Anscombe's quartet

#### Simpson's Paradox


## Examples

```{r, eval = FALSE, echo = TRUE}

# EXAMPLE CODE

```


## Datasets

|File | Rows | Columns |
|:----|:-----|:------|
|[XXX]() | Nrow | Ncol |
|[XXX]() | Nrow | Ncol |

SHORT VERBAL DESCRIPTION OF DATA SETS

#### Variable description

| Name | Description |
|:-------------|:-------------------------------------|
| XXX | XXX |
| XXX | age in years at baseline|
|wtkg| weight in kg at baseline|
|hemo| hemophilia (0=no, 1=yes)|
|homo| homosexual activity (0=no, 1=yes)|
|drugs| history of intravenous drug use (0=no, 1=yes)|
|karnof| Karnofsky score (on a scale of 0-100)|
|oprior| non-zidovudine antiretroviral therapy prior to initiation of study treatment (0=no, 1=yes)|
|z30| zidovudine use in the 30 days prior to treatment initiation (0=no, 1=yes)|
|zprior| zidovudine use prior to treatment initiation (0=no, 1=yes)|
|preanti| number of days of previously received antiretroviral therapy|
|race| race (0=white, 1=non-white)|
|gender| gender (0=female, 1=male)|
|str2| antiretroviral history (0=naive, 1=experienced)|
|strat| antiretroviral history stratification (1=’antiretroviral naive’, 2=’> 1 but ≤ 52 weeks of prior antiretroviral therapy’, 3=’> 52 weeks’)|
|symptom| symptomatic indicator (0=asymptomatic, 1=symptomatic)|
|treat| treatment indicator (0=zidovudine only, 1=other therapies)|
|offtrt| indicator of off-treatment before 96±5 weeks (0=no,1=yes)|
|cd40| CD4 T cell count at baseline|
|cd420| CD4 T cell count at 20±5 weeks|
|cd496| CD4 T cell count at 96±5 weeks (=NA if missing)|
|r| missing CD4 T cell count at 96±5 weeks (0=missing, 1=observed)|
|cd80| CD8 T cell count at baseline|
|cd820| CD8 T cell count at 20±5 weeks|
|cens| indicator of observing the event in days|
|days| number of days until the first occurrence of: (i) a decline in CD4 T cell count of at least 50 (ii) an event indicating progression to AIDS, or (iii) death.|
|arms| treatment arm (0=zidovudine, 1=zidovudine and didanosine, 2=zidovudine and zalcitabine, 3=didanosine).|

## Functions

### Packages

|Package| Installation|
|:------|:------|
|`tidyverse`|`install.packages("tidyverse")`|
| `XX` | `XX` |

### Functions

| Function| Package | Description |
|:---|:------|:---------------------------------------------|
|     `XXX`|`XXX`| XXX | 
|     `XXX`|`XXX`| XXX | 

## Resources

### vignettes

TEXT and LINKS

### Cheatsheets

<p align="center" width="100%">
<a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">
  <img src="https://image.slidesharecdn.com/data-wrangling-cheatsheet-160705210122/95/data-wrangling-with-dplyr-and-tidyr-cheat-sheet-1-638.jpg?cb=1467752577" style="width:70%"></a>
  <br>
  <font style="font-size:10px">from <a href="https://www.rstudio.com/resources/cheatsheets/">R Studio</a></font>
</p>
